<app-topbar></app-topbar>

<div class="dashboard container py-4">
  <h1 class="display-4 text-center">Tableau de Bord</h1>
  <div class="row">
      
      <!-- Ventes de la veille -->
      <div class="col-md-3 mb-4">
          <div class="card rounded-3 border-opacity-50 border">
              <div class="card-body d-flex justify-content-between align-items-center">
                  <div>
                      <h5 class="card-title">Ventes de la veille</h5>
                      <p class="card-text">
                          {{ ventesHier.message || ventesHier.nombreVentes + ' ventes' }}
                      </p>
                  </div>
                  <div *ngIf="ventesHier.evolution !== undefined" style="margin-left: 20px;">
                      <i 
                          [ngClass]="{
                              'pi pi-chart-line text-success':     ventesHier.evolution > 0,
                              'pi pi-chart-line-down text-danger': ventesHier.evolution < 0
                          }"
                        >
                      </i>
                  </div>
              </div>
              <div class="progress mt-2">
                  <div 
                      class="progress-bar" 
                      [ngClass]="ventesHier.evolution! > 0 ? 'bg-success' : 'bg-danger'" 
                      role="progressbar" 
                      [style.width.%]="getLimitedEvolution(ventesHier)">
                  </div>
              </div>
          </div>
      </div>

         <!-- Ventes du mois -->
         <div class="col-md-3 mb-4">
          <div class="card">
              <div class="card-body">
                  <h5 class="card-title">Ventes du mois</h5>
                  <p class="card-text">
                      {{ ventesMois.message || ventesMois.VenteMois }}
                      
                      <img 
                          *ngIf="ventesMois.evolution! > 0" 
                          src="/src/components/director/icons/icons8-stocks-growth-48.png" 
                          
                          alt="Ventes en augmentation" 
                          >
                      <img 
                          *ngIf="ventesMois.evolution! < 0" 
                          src="assets/icons/icons8-decrease-48.png" 
                          alt="Ventes en diminution" 
                        >
                      
                      <span *ngIf="ventesMois.evolution !== 0">
                          ({{ ventesMois.evolution | number }})
                      </span>
                  </p>
              </div>
              <div class="progress mt-2">
                  <div 
                      class="progress-bar" 
                      [ngClass]="ventesMois.evolution! > 0 ? 'bg-success' : 'bg-danger'" 
                      role="progressbar" 
                      [style.width.%]="getLimitedEvolution(ventesMois)">
                  </div>
              </div>
          </div>
      </div>

      <!-- Ventes de l'année -->
      <div class="col-md-3 mb-4">
          <div class="card">
              <div class="card-body">
                  <h5 class="card-title">Ventes de l'année</h5>
                  <p class="card-text">
                      {{ ventesAn.message || ventesAn.ventesAn + ' ventes' }}
                      <span *ngIf="ventesAn.evolution !== 0">
                        ({{ ventesAn.evolution | number }})
                    </span>
                      
                      <i 
                          *ngIf="ventesAn.evolution !== 0"
                          [ngClass]="{
                              'pi pi-chart-line text-success':    ventesAn.evolution! > 0,
                              'pi pi-chart-line-down text-danger': ventesAn.evolution! < 0
                          }">
                      </i>
                  </p>
              </div>
              <div class="progress mt-2">
                  <div 
                      class="progress-bar" 
                      [ngClass]="ventesAn.evolution! > 0 ? 'bg-success' : 'bg-danger'" 
                      role="progressbar" 
                      [style.width.%]="getLimitedEvolution(ventesMois)">
                  </div>
              </div>
          </div>
      </div>





        <!-- Quatrième carte -->
        <div class="col-md-3 mb-4">
          <div class="card rounded-3 border-opacity-50 border">
            <div class="card-body">
              <div class="flex flex-col md:flex-row gap-4">
                <div class="md:w-1/2">
                  <p-progressbar [value]="progression" [showValue]="true" pTooltip="{{ venteTotal }} €"></p-progressbar>
                </div>
              </div>
            </div>
            <div class="d-flex align-items-center gap-2">
              <input 
                type="number" 
                class="form-control form-control-sm w-50" 
                [(ngModel)]="objectif" 
                placeholder="Définissez votre objectif"
                min="0"
              />
              <button 
                type="button" 
                class="btn btn-primary btn-sm d-flex align-items-center gap-1 px-3"
                (click)="updateObjectif(objectif)"
                pTooltip="Mettre à jour l'objectif"
              >
                <i class="pi pi-save"></i>
                <span>Enregistrer</span>
              </button>
            </div>
            

            
          
            
          </div>
        </div>      
    </div>

    <!-- Section des graphiques -->
    <div class="row">
        <!-- Graphique 1 -->
        <div class="col-md-6 mb-4">
            <app-chart-par-jour></app-chart-par-jour>
        </div>

        <!-- Graphique 2 -->
        <div class="col-md-6 mb-4">
            <app-chart-par-mois></app-chart-par-mois>
        </div>
    </div>
    <div class="row card rounded-3 border-opacity-50 border">
        <app-list-all-vente></app-list-all-vente>
    </div>
</div>

<app-modal-objectif  (objectifChanged)="updateObjectif($event)"></app-modal-objectif>

